<!-- $Id: perso_module/individu.txt v 7.00 28/03/2017 20:05:52 hg -->
%( options
0: skip
1: standard
2: centered
3: two columns
%)
%let;op_m;%if;(op_m!="")%op_m;%else;1%end;%in;

%define;rebuild_url_hg(vvv)
  %let;new_url;%prefix;%nn;
  %access;;%nn;
  %if;(evar.num="on")
    num=on;%nn;
  %end;
  %if;(evar.nowrap="on")
    nowrap=on;%nn;
  %end;
  %if;(evar.title="on")
    title=on;%nn;
  %end;
  %if;(evar.birth="on")
    birth=on;%nn;
  %end;
  %if;(evar.birth_place="on")
    birth_place=on;%nn;
  %end;
  %if;(evar.marr= "on")
    marr=on;%nn;
  %end;
  %if;(evar.marr_date="on")
    marr_date=on;%nn;
  %end;
  %if;(evar.marr_place="on")
    marr_place=on;%nn;
  %end;
  %if;(evar.child="on")
    child=on;%nn;
  %end;
  %if;(evar.death="on")
    death=on;%nn;
  %end;
  %if;(evar.death_place="on")
    death_place=on;%nn;
  %end;
  %if;(evar.age="on")
    age=on;%nn;
  %end;
  %if;(evar.occu="on")
    occu=on;%nn;
  %end;
  %if;(evar.gen="on")
    gen=on;%nn;
  %end;
  %if;(evar.cgl="on")
    cgl=on;%nn;
  %end;
  fam=vvv;%in;
  %new_url;
%end;

%define;link(xxx,zzz)
  %if;(not cancel_links)<a href="%prefix;m=zzz;v=%sq;
    %if;("xxx"=first_name)%first_name_key;%sq;
    %elseif;("xxx"=surname)%surname_key;%sq;
    %( how to get (first/sur)_name_alias_keys? %)
    %else;xxx%sq;
    %end;">%sq;
  %end;xxx%if;(not cancel_links)</a>%end;
%end;

%define;short_display_person_image(xxx,yyy)
  <div class="media">
  %if;(evar.images="on" and ("yyy"="yes" or "yyy"="force"))
    <div class="media-left">
    %if;xxx.has_image;
      <a href="%xxx.image_url;" class="align-self-center" target="_blank">
        <img class="small_image rounded ml-0" src="%xxx.image_url;" alt="[image/images]0"%/>%nn;
      </a>
    %elseif;(bvar.default_image="yes")
      <img class="small_image align-self-center rounded ml-0" src="%image_prefix;/img_unknown_%if;(is_female)wo%elseif;(is_male)%else;u_%end;man.png" alt="[missing image]"%/>
    %else;
      <span class="small_image noimage align-self-center rounded display-3 text-center text-muted ml-0 pb-2">?</span>
    %end;
  </div>
  %end;
  <div class="media-body">
  %apply;image_MF("xxx")
  %apply;display_sosa("xxx")
  %if;(xxx.index=central_index and "yyy"!="force")<b>%xxx;</b>%else;
    %if;(cancel_links or xxx.is_restricted)%xxx;
    %else;<a href="%xxx.bname_prefix;%xxx.access;">%xxx;</a>%nn;
    %end;
  %end;
  %xxx.title; %xxx.dates;</span>%nn;
  </div>
  </div>
%end;


%define;detailed_names()
  %if;(has_qualifiers or has_aliases or has_nobility_titles or
       has_public_name or has_surnames_aliases or has_first_names_aliases or
       has_linked_page.HEAD or computable_death_age or computable_age)
    %foreach;qualifier;
      %if;not is_first;
        %if;has_public_name;%public_name; %qualifier;
        %else;%first_name; %qualifier;%end;<br>
      %end;
    %end;
    %if;(has_public_name or has_qualifiers)
      <span class="font-weight-bold">%apply;link(first_name,"P") %apply;link(surname,"N")</span><br>
    %end;
    %if;has_aliases;
      Alias%sp;
      %apply;lazy_print("")
      %foreach;alias;
        %if;(lazy_printed)/%end;
        %lazy_force;
        <b>%alias;</b>%nn;
      %end;
      <br>
    %end;
    %if;has_nobility_titles;
      <em>
      %foreach;nobility_title;
        %if;not is_first;,
        %end;
        %nobility_title;
      %end;
      </em><br>
    %end;
    %if;(has_linked_page.HEAD and linked_page.HEAD!="")%linked_page.HEAD;<br>%end;
    %if;has_first_names_aliases;
      %apply;lazy_print("")
      %apply;link(first_name,"P")/%sq;
      %foreach;first_name_alias;
        %if;(lazy_printed)/%end;
        %lazy_force;
        %apply;link(first_name_alias,"P")
      %end;
      <br>
    %end;
    %if;has_surnames_aliases;
      %apply;lazy_print("")
      %apply;link(surname,"N")/%sq;
      %foreach;surname_alias;
        %if;(lazy_printed)/%end;
        %lazy_force;
        %apply;link(surname_alias,"N")
      %end;
      <br>
    %end;
    %if;(is_dead and computable_death_age)%death_age%end;
    %if;(not is_dead and computable_age)%age;%end;
  %end;
%end;

%define;etat_civil()
  <ul>
    %if;has_birth_date;
      <li>%apply;capitalize(nth([born],sex)) %on_birth_date;
      %if;birthday; ([happy birthday to you!])%end;
      %if;has_birth_place; - %birth_place;%end;</li>%nl;
    %else;
      %if;has_birth_place;
        <li>%apply;capitalize(nth([born],sex)) - %birth_place;</li>%nl;
      %end;
    %end;
    %if;has_baptism_date;
      <li>%apply;capitalize(nth([baptized],sex)) %on_baptism_date;
      %if;has_baptism_place; - %baptism_place;%end;</li>%nl;
    %else;
      %if;has_baptism_place;
        <li>%apply;capitalize(nth([baptized],sex)) - %baptism_place;</li>%nl;
      %end;
    %end;
    %if;is_dead;
      <li>%apply;capitalize(died)
      %if;has_death_date; %on_death_date;%end;
      %if;has_death_place; - %death_place;%end;
      %if;(has_linked_page.DEATH and linked_page.DEATH!="") (%linked_page.DEATH;)%end;</li>%nl;
    %end;
    %if;is_buried;
      <li>%apply;capitalize(nth([buried],sex))
      %if;has_burial_date; %on_burial_date;%end;
      %if;has_burial_place; - %burial_place;%end;</li>%nl;
    %end;
    %if;is_cremated;
      <li>%apply;capitalize(nth([cremated],sex))
      %if;has_cremation_date; %on_cremation_date;%end;
      %if;has_cremation_place; - %cremation_place;%end;</li>%nl;
    %end;
    %if;has_occupation;
      <li>%apply;capitalize(occupation)</li>%nl;
    %end;
    %if;(has_linked_page.OCCU and linked_page.OCCU!="")
      <li>%apply;capitalize(linked_page.OCCU)</li>%nl;
    %end;
    %if;(has_consanguinity and bvar.show_consang!="no")
      <li>[*consanguinity][:] %consanguinity;</li>%nl;
    %end;
  </ul>
%end;

%define;portrait()
  %if;(has_image or bvar.default_image="yes")
    %if;has_image;
      <a href="%image_url;" target="_blank">
        <img src="%image_url;"%image_size; class="%if;(op_m=3)align-self-center mx-1%end; rounded" alt="[image/images]0"%/>%nn;
      </a>%nn;
    %elseif;(bvar.default_image="yes")
      <img class="%if;(op_m=3)d-flex align-self-center mx-1%end; rounded" src="%image_prefix;/img_unknown_%if;(is_female)wo%elseif;(is_male)%else;u_%end;man.png"%image_size; alt="[missing image]"%/>
    %end;
  %end;
%end;

%define;sosa()
  %if;(has_sosa and not cancel_links)
    <div class="%if;(op_m=2 or op_m=3)text-center%end;">
      <span class="fa fa-dot-circle-o text-success mr-1"></span>%nn;
      [*Sosa]
      %if;(sosa=1)%sosa;
      %else;<a href="%prefix;%sosa_link;">%sosa;</a> %apply;a_of_b%with;%and;
        %if;(sosa_ref.is_restricted)%sosa_ref;%else;<a href="%prefix;%sosa_ref.access;">%sosa_ref;</a>%end;%end;
      %end;
    </div>
  %end;
%end;

%if;(evar.m!="MOD_IND")
  <div class="row">
  <div class="col">
  <h1 class="%if;(p_mod="" or p_mod="zz")col-12%end; %if;(op_m=2)text-center%end; text-xs-center text-md-left">
    %if;has_public_name;
      %if;has_qualifiers;%public_name; <em>%qualifier;</em>
      %else;%public_name; %surname;%end;
    %else;
      %if;has_qualifiers;%first_name; <em>%qualifier;</em>
      %else;
        %if;cancel_links;%first_name; %surname;
        %else;
          <a href="%prefix;m=P;v=%first_name_key;#i%index;">%first_name;</a>
          <a href="%prefix;m=N;v=%surname_key;#i%index;">%surname;</a>
        %end;
      %end;
    %end;
    <br class="d-none d-sm-none">
    <span class="text-muted small mb-1">%dates;%(%birth_date.year;-%death_date.year; no italic?%)</span>
  </h1>
  </div>
  %let;evfam;%if;(evar.fam="")1%else;%evar.fam;%end;%in;
  <div class="col text-right">
    <div class="input-group mb-1">
      <span class="input-group-btn">
        <a href="%apply;rebuild_url_hg%with;%expr(evfam-1)%end" class="btn btn-outline-secondary" >-</a>
      </span>
      <input class="form-control text-center" value="Familles" disabled>
      <span class="input-group-btn">
        <a href="%apply;rebuild_url_hg%with;%expr(evfam+1)%end" class="btn btn-outline-secondary">+</a>
      </span>
    </div>
  </div>
  </div>
  %if;(op_m!=3)
    %apply;sosa()
  %end;
  %if;(p_mod="" or p_mod="zz")<div class="col-12 col-lg-8">%end;
    %if;(op_m=3)
    <div class="d-inline-flex">
      %apply;portrait()
      <div>
        <div class="text-center mb-2 mx-2">
          %apply;detailed_names()
          %apply;sosa()
        </div>
        %apply;etat_civil()
      </div>
    </div>
  %elseif;(op_m=4)
    %let;fam_cnt;%evar.fam;%in;
    
    <div class="container">
      <div class="row">
        <div class="col border rounded mr-1 border-dark">
        %if;(has_parents)
          %if;(father.has_parents)
            %apply;short_display_person_image("father.father", "no")<br>
            %apply;short_display_person_image("father.mother", "no")
          %else; ?<br>?
          %end;
        %else; ?<br>?
        %end
        </div>

        <div class="col border rounded ml-1 mr-1 border-dark">
        %if;(has_parents)
          %if;(mother.has_parents)
            %apply;short_display_person_image("mother.father", "no")<br>
            %apply;short_display_person_image("mother.mother", "no")
          %else; ?<br>?
          %end;
        %else; ?<br>?
        %end
        </div>

        <div class="col border rounded ml-1 mr-1 border-dark">
        %foreach;family;
          %if;(family_cnt=fam_cnt)
            %if;(spouse!="")
              %if;(spouse.father.has_parents)
                %apply;short_display_person_image("spouse.father.father", "no")<br>
                %apply;short_display_person_image("spouse.father.mother", "no")
              %end;
            %end;
          %end;
        %end;
        </div>

        <div class="col border rounded ml-1 border-dark">
        %foreach;family;
          %if;(family_cnt=fam_cnt)
            %if;(spouse!="")
              %if;(spouse.mother.has_parents)
                %apply;short_display_person_image("spouse.mother.father", "no")<br>
                %apply;short_display_person_image("spouse.mother.mother", "no")
              %end;
            %end;
          %end;
        %end;
        </div>

      </div>
      <div class="row">
        <div class="col" style="text-align:center">
        |
        </div>
        <div class="col" style="text-align:center">
        |
        </div>
        <div class="col" style="text-align:center">
        |
        </div>
        <div class="col" style="text-align:center">
        |
        </div>
      </div>

      <div class="row">
        <div class="col border rounded mr-1 border-dark">
        %if;(has_parents)
          %apply;short_display_person_image("father", "yes")
        %else; ?<br>?
        %end
        </div>
        <div class="col border rounded ml-1 mr-1 border-dark">

        %if;(has_parents)
          %apply;short_display_person_image("mother", "yes")
        %else; ?<br>?
        %end
        </div>

        <div class="col border rounded ml-1 mr-1 border-dark">
        %foreach;family;
          %if;(family_cnt=fam_cnt)
            %if;(spouse!="")
              %if;(spouse.has_parents)
                %apply;short_display_person_image("spouse.father", "yes")
              %end;
            %end;
          %end;
        %end;
        </div>

        <div class="col border rounded ml-1 border-dark">
        %foreach;family;
          %if;(family_cnt=fam_cnt)
            %if;(spouse!="")
              %if;(spouse.has_parents)
                %apply;short_display_person_image("spouse.mother", "yes")
              %end;
            %end;
          %end;
        %end;
        </div>
      </div>

      <div class="row">
        <div class="col" style="text-align:center">
        |
        </div>
        <div class="col" style="text-align:center">
        |
        </div>
      </div>

      %foreach;family;
        <div class="row">
          <div class="col border rounded mr-1 border-dark">
            %apply;short_display_person_image("self", "force")
          </div>
          <div class="col border rounded ml-1 border-dark">
            %if;(family_cnt=fam_cnt)
              %if;(spouse!="")
                %apply;short_display_person_image("spouse", "yes")
              %end;
            %else;
              <a href="%apply;rebuild_url_hg%with;%family_cnt;%end">%spouse;</a>
            %end;
          </div>
       </div>
     %end;

      <div class="row">
        <div class="col" style="text-align:center">
        |
        </div>
      </div>

      <div class="row">
        <div class="col">
        %if;(has_parents)
          %foreach;father.family;
            <div class="border rounded border-dark %if;(family_cnt>1)mt-3%end; mb-2">
            %if;(family_cnt=1)Frères et soeurs%else;1/2 frères et soeurs avec %father.spouse;%end;
            </div>
            %foreach;child;
              <div class="border rounded border-dark">
                %apply;short_display_person_image("child", "yes")
              </div>
            %end;
          %end;
        %end;
        </div>
        <div class="col">
        <div class="border rounded border-dark  %if;(family_cnt>1)mt-3%end; mb-2">
        Enfants
        </div>
        %foreach;family;
          %if;(family_cnt=fam_cnt)
            %foreach;child
              <div class="border rounded border-dark">
                %apply;short_display_person_image("child", "yes")
              </div>
            %end;
          %end;
        %end;
        </div>
        <div class="col">
        %foreach;family;
          %if;(family_cnt=fam_cnt)
          %foreach;spouse.father.family;
            <div class="border rounded border-dark %if;(family_cnt>1)mt-3%end; mb-2">
            %if;(family_cnt=1)Frères et soeurs%else;1/2 frères et soeurs with %spouse;%end;
            </div>
            %foreach;child;
              <div class="border rounded border-dark">
                %apply;short_display_person_image("child", "yes")
              </div>
            %end;
          %end;
          %end;
        %end;
        </div>
      </div>

    </div>
  %else;
    %apply;portrait()
    <div class="mt-2 mb-1 ml-2">
      %apply;detailed_names()
    </div>
      %apply;etat_civil()
  %end;
%end;
